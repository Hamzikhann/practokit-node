(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{"luD+":function(e,t,s){"use strict";s.r(t),s.d(t,"MessagesModule",(function(){return B}));var c=s("ofXK"),a=s("3Pt+"),r=s("tyNb"),i=s("wd/R"),n=s("fXoL"),o=s("tk/3"),d=s("EdIQ");let b=(()=>{class e{constructor(e,t){this.http=e,this.config=t,this.baseUrl=this.config.reqBaseUrl+"messages/"}sendMessage(e){return this.http.post(this.baseUrl,e,{observe:"response"})}getThreads(){return this.http.get(this.baseUrl+"threads",{observe:"response"})}getChat(e){return this.http.get(this.baseUrl+e,{observe:"response"})}getUsers(){return this.http.get(this.baseUrl+"users",{observe:"response"})}getThreadByUserId(e){return this.http.get(this.baseUrl+"thread/find/"+e,{observe:"response"})}}return e.\u0275fac=function(t){return new(t||e)(n.jc(o.b),n.jc(d.a))},e.\u0275prov=n.Sb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var g=s("5eHb"),l=s("oOf3");function m(e,t){if(1&e&&(n.bc(0,"div",41),n.Xb(1,"img",42),n.bc(2,"span"),n.Oc(3),n.ac(),n.ac()),2&e){const e=t.$implicit,s=n.pc(3);n.Ib(1),n.wc("src",s.imgUrl+e.user.profile.profileImg,n.Gc),n.Ib(2),n.Pc(e.user.firstName+" "+e.user.lastName)}}function h(e,t){if(1&e&&(n.bc(0,"div",43),n.Oc(1),n.ac()),2&e){const e=t.$implicit;n.Ib(1),n.Qc(" ",e.message," ")}}function u(e,t){if(1&e&&(n.bc(0,"div",44),n.Oc(1),n.ac()),2&e){const e=t.$implicit,s=n.pc(3);n.Ib(1),n.Qc(" ",s.Format(e.createdAt)," ")}}function p(e,t){if(1&e){const e=n.cc();n.bc(0,"tr",37),n.mc("click",(function(){n.Ec(e);const s=t.$implicit;return n.pc(2).SeeMessages(s)})),n.bc(1,"td"),n.Mc(2,m,4,2,"div",38),n.ac(),n.bc(3,"td"),n.Mc(4,h,2,1,"div",39),n.ac(),n.bc(5,"td"),n.Mc(6,u,2,1,"div",40),n.ac(),n.ac()}if(2&e){const e=t.$implicit;n.Ib(2),n.vc("ngForOf",e.messagesThread.participants),n.Ib(2),n.vc("ngForOf",e.messagesThread.messages),n.Ib(2),n.vc("ngForOf",e.messagesThread.messages)}}function f(e,t){if(1&e){const e=n.cc();n.bc(0,"pagination-controls",45),n.mc("pageChange",(function(t){return n.Ec(e),n.pc(2).p=t})),n.ac()}}function v(e,t){if(1&e&&(n.bc(0,"div",27),n.bc(1,"div",28),n.bc(2,"div",29),n.bc(3,"div",20),n.bc(4,"div",30),n.bc(5,"table",31),n.bc(6,"thead"),n.bc(7,"tr"),n.bc(8,"th",32),n.Oc(9,"user"),n.ac(),n.bc(10,"th",33),n.Oc(11,"Last Messages"),n.ac(),n.bc(12,"th",34),n.Oc(13,"Date"),n.ac(),n.ac(),n.ac(),n.bc(14,"tbody"),n.Mc(15,p,7,3,"tr",35),n.ac(),n.ac(),n.ac(),n.ac(),n.Mc(16,f,1,0,"pagination-controls",36),n.ac(),n.ac(),n.ac()),2&e){const e=n.pc();n.Ib(15),n.vc("ngForOf",e.filteredThreads),n.Ib(1),n.vc("ngIf",e.filteredThreads.length>10)}}function M(e,t){1&e&&(n.bc(0,"div",46),n.Xb(1,"img",47),n.bc(2,"p"),n.Oc(3,"No Messages found"),n.ac(),n.ac())}function I(e,t){1&e&&(n.bc(0,"div",46),n.Xb(1,"img",48),n.ac())}function O(e,t){if(1&e){const e=n.cc();n.bc(0,"a",49),n.bc(1,"div",50),n.mc("click",(function(){n.Ec(e);const s=t.$implicit;return n.pc().setUser(s)})),n.bc(2,"div",41),n.Xb(3,"img",42),n.bc(4,"span"),n.Oc(5),n.ac(),n.ac(),n.ac(),n.ac()}if(2&e){const e=t.$implicit,s=n.pc();n.Ib(3),n.wc("src",s.imgUrl+e.profile.profileImg,n.Gc),n.Ib(2),n.Pc(e.firstName+" "+e.lastName)}}function y(e,t){1&e&&(n.bc(0,"div",46),n.Xb(1,"img",47),n.bc(2,"p"),n.Oc(3,"No Users found"),n.ac(),n.ac())}function C(e,t){if(1&e){const e=n.cc();n.bc(0,"div",18),n.bc(1,"div",19),n.bc(2,"label"),n.Oc(3,"Send Message to "),n.bc(4,"strong"),n.Oc(5),n.ac(),n.ac(),n.bc(6,"textarea",51),n.mc("ngModelChange",(function(t){return n.Ec(e),n.pc().message.message=t})),n.ac(),n.ac(),n.ac()}if(2&e){const e=n.pc();n.Ib(5),n.Pc(e.message.user.firstName+" "+e.message.user.lastName),n.Ib(1),n.vc("ngModel",e.message.message)}}const w=function(){return["/"]};let P=(()=>{class e{constructor(e,t,s,c){this.messageService=e,this.config=t,this.toastr=s,this.router=c,this.loading=!0,this.p=1,this.imgUrl=this.config.imgBaseUrl,this.search="",this.users=[],this.threads=[],this.filteredThreads=[],this.message={user:"",message:"",threadId:""}}ngOnInit(){this.getThreads(),this.getUsers()}getThreads(){this.messageService.getThreads().subscribe(e=>{this.threads=e.body,this.filteredThreads=this.threads,this.loading=!1})}getUsers(){this.messageService.getUsers().subscribe(e=>{this.users=e.body})}Format(e){return i(e).fromNow()}setUser(e){this.messageService.getThreadByUserId(e.id).subscribe(t=>{this.message={user:e,message:"",threadId:t.body.threadId}})}sendMessage(){this.messageService.sendMessage({message:this.message.message,receiverId:this.message.user.id,threadId:this.message.threadId}).subscribe(e=>{this.toastr.success("Message Sent"),this.message={user:"",message:"",threadId:""},this.getThreads()})}SeeMessages(e){localStorage.setItem("chatUser",JSON.stringify(e.messagesThread.participants[0])),this.router.navigate(["/messages",e.messagesThread.id])}}return e.\u0275fac=function(t){return new(t||e)(n.Wb(b),n.Wb(d.a),n.Wb(g.b),n.Wb(r.c))},e.\u0275cmp=n.Qb({type:e,selectors:[["app-message-threads"]],decls:49,vars:9,consts:[[1,"page-content"],[1,"page-info"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item"],[3,"routerLink"],["aria-current","page",1,"breadcrumb-item","active"],[1,"page-options"],["href","javascript:void(0)","data-toggle","modal","data-target","#selectuser","id","mail-compose",1,"btn","btn-primary","w-100"],["class","main-wrapper",4,"ngIf"],["class","placeholder",4,"ngIf"],["id","selectuser","tabindex","-1","role","dialog","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],["id","exampleModalLabel",1,"modal-title"],["type","button","data-dismiss","modal","aria-label","Close",1,"close"],[1,"material-icons"],[1,"modal-body"],[1,"form-group"],[1,"card"],["href","javascript:void(0)",4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button","data-dismiss","modal",1,"btn","btn-secondary"],["id","newMessage","tabindex","-1","role","dialog","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],["class","modal-body",4,"ngIf"],["type","button","data-dismiss","modal",1,"btn","btn-primary",3,"disabled","click"],[1,"main-wrapper"],[1,"row"],[1,"col-lg-12"],[1,"card-body","p-0"],[1,"table","table-striped","m-0"],["scope","col",1,"username"],["scope","col",1,"message"],["scope","col",1,"date"],["style","cursor: pointer;",3,"click",4,"ngFor","ngForOf"],["class","inbox-pagination",3,"pageChange",4,"ngIf"],[2,"cursor","pointer",3,"click"],["class","mail-author",4,"ngFor","ngForOf"],["class","mail-title",4,"ngFor","ngForOf"],["class","mail-date",4,"ngFor","ngForOf"],[1,"mail-author"],["onerror","this.src='assets/images/default-user.png'",3,"src"],[1,"mail-title"],[1,"mail-date"],[1,"inbox-pagination",3,"pageChange"],[1,"placeholder"],["src","assets/images/no-data.png","alt",""],["src","assets/images/loader.gif","alt",""],["href","javascript:void(0)"],["data-toggle","modal","data-target","#newMessage","data-dismiss","modal",1,"new-message-card-body",3,"click"],["type","text","id","new-task-name","placeholder","Type your message here...",1,"form-control",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(n.bc(0,"div",0),n.bc(1,"div",1),n.bc(2,"nav",2),n.bc(3,"ol",3),n.bc(4,"li",4),n.bc(5,"a",5),n.Oc(6,"Dashboard"),n.ac(),n.ac(),n.bc(7,"li",6),n.Oc(8,"Inbox"),n.ac(),n.ac(),n.ac(),n.bc(9,"div",7),n.bc(10,"a",8),n.Oc(11,"Compose"),n.ac(),n.ac(),n.ac(),n.Mc(12,v,17,2,"div",9),n.Mc(13,M,4,0,"div",10),n.Mc(14,I,2,0,"div",10),n.ac(),n.bc(15,"div",11),n.bc(16,"div",12),n.bc(17,"div",13),n.bc(18,"div",14),n.bc(19,"h5",15),n.Oc(20,"New Message"),n.ac(),n.bc(21,"button",16),n.bc(22,"i",17),n.Oc(23,"close"),n.ac(),n.ac(),n.ac(),n.bc(24,"div",18),n.bc(25,"div",19),n.bc(26,"label"),n.Oc(27,"Select who you want to send message to"),n.ac(),n.bc(28,"div",20),n.Mc(29,O,6,2,"a",21),n.Mc(30,y,4,0,"div",10),n.ac(),n.ac(),n.ac(),n.bc(31,"div",22),n.bc(32,"button",23),n.Oc(33,"Cancel"),n.ac(),n.ac(),n.ac(),n.ac(),n.ac(),n.bc(34,"div",24),n.bc(35,"div",12),n.bc(36,"div",13),n.bc(37,"div",14),n.bc(38,"h5",15),n.Oc(39,"New Message"),n.ac(),n.bc(40,"button",16),n.bc(41,"i",17),n.Oc(42,"close"),n.ac(),n.ac(),n.ac(),n.Mc(43,C,7,2,"div",25),n.bc(44,"div",22),n.bc(45,"button",23),n.Oc(46,"Cancel"),n.ac(),n.bc(47,"button",26),n.mc("click",(function(){return t.sendMessage()})),n.Oc(48," Send"),n.ac(),n.ac(),n.ac(),n.ac(),n.ac()),2&e&&(n.Ib(5),n.vc("routerLink",n.yc(8,w)),n.Ib(7),n.vc("ngIf",t.filteredThreads.length&&!t.loading),n.Ib(1),n.vc("ngIf",!t.filteredThreads.length&&!t.loading),n.Ib(1),n.vc("ngIf",t.loading),n.Ib(15),n.vc("ngForOf",t.users),n.Ib(1),n.vc("ngIf",!t.users.length),n.Ib(13),n.vc("ngIf",t.message),n.Ib(4),n.vc("disabled",!t.message.message))},directives:[r.d,c.n,c.m,l.c,a.b,a.i,a.l],styles:[".table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:8px 20px;text-transform:capitalize}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th.username[_ngcontent-%COMP%]{width:25%}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th.message[_ngcontent-%COMP%]{width:55%}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th.date[_ngcontent-%COMP%]{width:20%}.mail-title[_ngcontent-%COMP%]{padding:4px 0}"]}),e})();var U=s("7JkF");const T=function(e,t){return{"message-right":e,"message-left":t}};function S(e,t){if(1&e&&(n.bc(0,"ul",21),n.bc(1,"li",22),n.bc(2,"div",23),n.Xb(3,"img",24),n.ac(),n.bc(4,"div",25),n.bc(5,"p"),n.Oc(6),n.ac(),n.bc(7,"span"),n.Oc(8),n.ac(),n.ac(),n.ac(),n.ac()),2&e){const e=t.$implicit,s=n.pc();n.Ib(1),n.vc("ngClass",n.Ac(4,T,e.createdBy==s.currentUser.id,e.createdBy!=s.currentUser.id)),n.Ib(2),n.wc("src",s.imgUrl+e.user.profile.profileImg,n.Gc),n.Ib(3),n.Pc(e.message),n.Ib(2),n.Pc(s.Format(e.createdAt))}}const _=function(){return["/"]},k=function(){return["/messages"]};let F=(()=>{class e{constructor(e,t,s,c,a){this.activatedRoute=e,this.messageService=t,this.config=s,this.toastr=c,this.socket=a,this.chat=[]}ngOnInit(){this.threadId=this.activatedRoute.snapshot.paramMap.get("threadId"),this.currentUser=JSON.parse(localStorage.getItem("user")),this.reciever=JSON.parse(localStorage.getItem("chatUser")),this.imgUrl=this.config.imgBaseUrl,this.getMessages(),this.currentDocument=this.socket.fromEvent("thread:"+this.threadId),this._docSub=this.currentDocument.subscribe(e=>{this.chat.push(e),setTimeout(()=>{this.scrollToBottom()},100)})}ngOnDestroy(){this._docSub.unsubscribe()}getMessages(){this.messageService.getChat(this.threadId).subscribe(e=>{this.chat=e.body,setTimeout(()=>{this.scrollToBottom()},500)})}scrollToBottom(){var e=document.getElementById("scrollDiv");e.scrollTop=e.scrollHeight}Format(e){return i(e).format("MMMM Do, YYYY h:mm")}SendMessage(){this.message&&this.messageService.sendMessage({message:this.message,threadId:this.threadId,receiverId:this.reciever.userId}).subscribe(e=>{this.toastr.success("Message sent."),this.message=""})}}return e.\u0275fac=function(t){return new(t||e)(n.Wb(r.a),n.Wb(b),n.Wb(d.a),n.Wb(g.b),n.Wb(U.a))},e.\u0275cmp=n.Qb({type:e,selectors:[["app-messages"]],decls:28,vars:9,consts:[[1,"page-content"],[1,"page-info"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item"],[3,"routerLink"],["aria-current","page",1,"breadcrumb-item","active"],[1,"main-wrapper"],[1,"row"],[1,"col-lg-12"],[1,"card"],[1,"card-body","p-0"],[1,"msg-head"],["id","scrollDiv",1,"scrollbar",2,"height","400px"],["class","messages-wrap",4,"ngFor","ngForOf"],[1,"type-message",2,"border-radius","unset"],[1,"input"],["type","text","placeholder","Type your message here",1,"form-control",3,"ngModel","ngModelChange","keyup.enter"],[1,"send"],[1,"btn",3,"disabled","click"],["src","assets/images/ic-send-white.png","alt",""],[1,"messages-wrap"],[3,"ngClass"],[1,"user-thumb"],["alt","","onerror","this.src='assets/images/default-user.png'",3,"src"],[1,"chat-bubble"]],template:function(e,t){1&e&&(n.bc(0,"div",0),n.bc(1,"div",1),n.bc(2,"nav",2),n.bc(3,"ol",3),n.bc(4,"li",4),n.bc(5,"a",5),n.Oc(6,"Apps"),n.ac(),n.ac(),n.bc(7,"li",4),n.bc(8,"a",5),n.Oc(9,"Inbox"),n.ac(),n.ac(),n.bc(10,"li",6),n.Oc(11),n.ac(),n.ac(),n.ac(),n.ac(),n.bc(12,"div",7),n.bc(13,"div",8),n.bc(14,"div",9),n.bc(15,"div",10),n.bc(16,"div",11),n.bc(17,"div",12),n.bc(18,"h5"),n.Oc(19),n.ac(),n.ac(),n.bc(20,"div",13),n.Mc(21,S,9,7,"ul",14),n.ac(),n.bc(22,"div",15),n.bc(23,"div",16),n.bc(24,"input",17),n.mc("ngModelChange",(function(e){return t.message=e}))("keyup.enter",(function(){return t.SendMessage()})),n.ac(),n.ac(),n.bc(25,"div",18),n.bc(26,"button",19),n.mc("click",(function(){return t.SendMessage()})),n.Xb(27,"img",20),n.ac(),n.ac(),n.ac(),n.ac(),n.ac(),n.ac(),n.ac(),n.ac(),n.ac()),2&e&&(n.Ib(5),n.vc("routerLink",n.yc(7,_)),n.Ib(3),n.vc("routerLink",n.yc(8,k)),n.Ib(3),n.Qc(" ",t.reciever.user.firstName+" "+t.reciever.user.lastName," "),n.Ib(8),n.Pc(t.reciever.user.firstName+" "+t.reciever.user.lastName),n.Ib(2),n.vc("ngForOf",t.chat),n.Ib(3),n.vc("ngModel",t.message),n.Ib(2),n.vc("disabled",!t.message))},directives:[r.d,c.m,a.b,a.i,a.l,c.l],styles:[".msg-head[_ngcontent-%COMP%]{padding:12px 20px;border-bottom:1px solid #dae6f6}.msg-head[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin-bottom:0}.type-message[_ngcontent-%COMP%]{margin:0}.type-message[_ngcontent-%COMP%]   .send[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:14px}"]}),e})();const x={url:s("AytR").a.socketUrl,options:{}},N=[{path:"",component:P},{path:":threadId",component:F}];let B=(()=>{class e{}return e.\u0275mod=n.Ub({type:e}),e.\u0275inj=n.Tb({factory:function(t){return new(t||e)},imports:[[c.b,a.d,l.a,r.e.forChild(N),U.b.forRoot(x)]]}),e})()}}]);