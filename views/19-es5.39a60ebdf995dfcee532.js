!function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var a=0;a<t.length;a++){var c=t[a];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(e,c.key,c)}}function a(e,a,c){return a&&t(e.prototype,a),c&&t(e,c),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{"luD+":function(t,c,s){"use strict";s.r(c),s.d(c,"MessagesModule",(function(){return $}));var n,i=s("ofXK"),r=s("3Pt+"),o=s("tyNb"),d=s("wd/R"),b=s("fXoL"),l=s("tk/3"),g=s("EdIQ"),u=((n=function(){function t(a,c){e(this,t),this.http=a,this.config=c,this.baseUrl=this.config.reqBaseUrl+"messages/"}return a(t,[{key:"sendMessage",value:function(e){return this.http.post(this.baseUrl,e,{observe:"response"})}},{key:"getThreads",value:function(){return this.http.get(this.baseUrl+"threads",{observe:"response"})}},{key:"getChat",value:function(e){return this.http.get(this.baseUrl+e,{observe:"response"})}},{key:"getUsers",value:function(){return this.http.get(this.baseUrl+"users",{observe:"response"})}},{key:"getThreadByUserId",value:function(e){return this.http.get(this.baseUrl+"thread/find/"+e,{observe:"response"})}}]),t}()).\u0275fac=function(e){return new(e||n)(b.jc(l.b),b.jc(g.a))},n.\u0275prov=b.Sb({token:n,factory:n.\u0275fac,providedIn:"root"}),n),m=s("5eHb"),h=s("oOf3");function f(e,t){if(1&e&&(b.bc(0,"div",41),b.Xb(1,"img",42),b.bc(2,"span"),b.Oc(3),b.ac(),b.ac()),2&e){var a=t.$implicit,c=b.pc(3);b.Ib(1),b.wc("src",c.imgUrl+a.user.profile.profileImg,b.Gc),b.Ib(2),b.Pc(a.user.firstName+" "+a.user.lastName)}}function p(e,t){if(1&e&&(b.bc(0,"div",43),b.Oc(1),b.ac()),2&e){var a=t.$implicit;b.Ib(1),b.Qc(" ",a.message," ")}}function v(e,t){if(1&e&&(b.bc(0,"div",44),b.Oc(1),b.ac()),2&e){var a=t.$implicit,c=b.pc(3);b.Ib(1),b.Qc(" ",c.Format(a.createdAt)," ")}}function M(e,t){if(1&e){var a=b.cc();b.bc(0,"tr",37),b.mc("click",(function(){b.Ec(a);var e=t.$implicit;return b.pc(2).SeeMessages(e)})),b.bc(1,"td"),b.Mc(2,f,4,2,"div",38),b.ac(),b.bc(3,"td"),b.Mc(4,p,2,1,"div",39),b.ac(),b.bc(5,"td"),b.Mc(6,v,2,1,"div",40),b.ac(),b.ac()}if(2&e){var c=t.$implicit;b.Ib(2),b.vc("ngForOf",c.messagesThread.participants),b.Ib(2),b.vc("ngForOf",c.messagesThread.messages),b.Ib(2),b.vc("ngForOf",c.messagesThread.messages)}}function I(e,t){if(1&e){var a=b.cc();b.bc(0,"pagination-controls",45),b.mc("pageChange",(function(e){return b.Ec(a),b.pc(2).p=e})),b.ac()}}function y(e,t){if(1&e&&(b.bc(0,"div",27),b.bc(1,"div",28),b.bc(2,"div",29),b.bc(3,"div",20),b.bc(4,"div",30),b.bc(5,"table",31),b.bc(6,"thead"),b.bc(7,"tr"),b.bc(8,"th",32),b.Oc(9,"user"),b.ac(),b.bc(10,"th",33),b.Oc(11,"Last Messages"),b.ac(),b.bc(12,"th",34),b.Oc(13,"Date"),b.ac(),b.ac(),b.ac(),b.bc(14,"tbody"),b.Mc(15,M,7,3,"tr",35),b.ac(),b.ac(),b.ac(),b.ac(),b.Mc(16,I,1,0,"pagination-controls",36),b.ac(),b.ac(),b.ac()),2&e){var a=b.pc();b.Ib(15),b.vc("ngForOf",a.filteredThreads),b.Ib(1),b.vc("ngIf",a.filteredThreads.length>10)}}function O(e,t){1&e&&(b.bc(0,"div",46),b.Xb(1,"img",47),b.bc(2,"p"),b.Oc(3,"No Messages found"),b.ac(),b.ac())}function k(e,t){1&e&&(b.bc(0,"div",46),b.Xb(1,"img",48),b.ac())}function C(e,t){if(1&e){var a=b.cc();b.bc(0,"a",49),b.bc(1,"div",50),b.mc("click",(function(){b.Ec(a);var e=t.$implicit;return b.pc().setUser(e)})),b.bc(2,"div",41),b.Xb(3,"img",42),b.bc(4,"span"),b.Oc(5),b.ac(),b.ac(),b.ac(),b.ac()}if(2&e){var c=t.$implicit,s=b.pc();b.Ib(3),b.wc("src",s.imgUrl+c.profile.profileImg,b.Gc),b.Ib(2),b.Pc(c.firstName+" "+c.lastName)}}function w(e,t){1&e&&(b.bc(0,"div",46),b.Xb(1,"img",47),b.bc(2,"p"),b.Oc(3,"No Users found"),b.ac(),b.ac())}function P(e,t){if(1&e){var a=b.cc();b.bc(0,"div",18),b.bc(1,"div",19),b.bc(2,"label"),b.Oc(3,"Send Message to "),b.bc(4,"strong"),b.Oc(5),b.ac(),b.ac(),b.bc(6,"textarea",51),b.mc("ngModelChange",(function(e){return b.Ec(a),b.pc().message.message=e})),b.ac(),b.ac(),b.ac()}if(2&e){var c=b.pc();b.Ib(5),b.Pc(c.message.user.firstName+" "+c.message.user.lastName),b.Ib(1),b.vc("ngModel",c.message.message)}}var U,T=function(){return["/"]},S=((U=function(){function t(a,c,s,n){e(this,t),this.messageService=a,this.config=c,this.toastr=s,this.router=n,this.loading=!0,this.p=1,this.imgUrl=this.config.imgBaseUrl,this.search="",this.users=[],this.threads=[],this.filteredThreads=[],this.message={user:"",message:"",threadId:""}}return a(t,[{key:"ngOnInit",value:function(){this.getThreads(),this.getUsers()}},{key:"getThreads",value:function(){var e=this;this.messageService.getThreads().subscribe((function(t){e.threads=t.body,e.filteredThreads=e.threads,e.loading=!1}))}},{key:"getUsers",value:function(){var e=this;this.messageService.getUsers().subscribe((function(t){e.users=t.body}))}},{key:"Format",value:function(e){return d(e).fromNow()}},{key:"setUser",value:function(e){var t=this;this.messageService.getThreadByUserId(e.id).subscribe((function(a){t.message={user:e,message:"",threadId:a.body.threadId}}))}},{key:"sendMessage",value:function(){var e=this;this.messageService.sendMessage({message:this.message.message,receiverId:this.message.user.id,threadId:this.message.threadId}).subscribe((function(t){e.toastr.success("Message Sent"),e.message={user:"",message:"",threadId:""},e.getThreads()}))}},{key:"SeeMessages",value:function(e){localStorage.setItem("chatUser",JSON.stringify(e.messagesThread.participants[0])),this.router.navigate(["/messages",e.messagesThread.id])}}]),t}()).\u0275fac=function(e){return new(e||U)(b.Wb(u),b.Wb(g.a),b.Wb(m.b),b.Wb(o.c))},U.\u0275cmp=b.Qb({type:U,selectors:[["app-message-threads"]],decls:49,vars:9,consts:[[1,"page-content"],[1,"page-info"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item"],[3,"routerLink"],["aria-current","page",1,"breadcrumb-item","active"],[1,"page-options"],["href","javascript:void(0)","data-toggle","modal","data-target","#selectuser","id","mail-compose",1,"btn","btn-primary","w-100"],["class","main-wrapper",4,"ngIf"],["class","placeholder",4,"ngIf"],["id","selectuser","tabindex","-1","role","dialog","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],["id","exampleModalLabel",1,"modal-title"],["type","button","data-dismiss","modal","aria-label","Close",1,"close"],[1,"material-icons"],[1,"modal-body"],[1,"form-group"],[1,"card"],["href","javascript:void(0)",4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button","data-dismiss","modal",1,"btn","btn-secondary"],["id","newMessage","tabindex","-1","role","dialog","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],["class","modal-body",4,"ngIf"],["type","button","data-dismiss","modal",1,"btn","btn-primary",3,"disabled","click"],[1,"main-wrapper"],[1,"row"],[1,"col-lg-12"],[1,"card-body","p-0"],[1,"table","table-striped","m-0"],["scope","col",1,"username"],["scope","col",1,"message"],["scope","col",1,"date"],["style","cursor: pointer;",3,"click",4,"ngFor","ngForOf"],["class","inbox-pagination",3,"pageChange",4,"ngIf"],[2,"cursor","pointer",3,"click"],["class","mail-author",4,"ngFor","ngForOf"],["class","mail-title",4,"ngFor","ngForOf"],["class","mail-date",4,"ngFor","ngForOf"],[1,"mail-author"],["onerror","this.src='assets/images/default-user.png'",3,"src"],[1,"mail-title"],[1,"mail-date"],[1,"inbox-pagination",3,"pageChange"],[1,"placeholder"],["src","assets/images/no-data.png","alt",""],["src","assets/images/loader.gif","alt",""],["href","javascript:void(0)"],["data-toggle","modal","data-target","#newMessage","data-dismiss","modal",1,"new-message-card-body",3,"click"],["type","text","id","new-task-name","placeholder","Type your message here...",1,"form-control",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(b.bc(0,"div",0),b.bc(1,"div",1),b.bc(2,"nav",2),b.bc(3,"ol",3),b.bc(4,"li",4),b.bc(5,"a",5),b.Oc(6,"Dashboard"),b.ac(),b.ac(),b.bc(7,"li",6),b.Oc(8,"Inbox"),b.ac(),b.ac(),b.ac(),b.bc(9,"div",7),b.bc(10,"a",8),b.Oc(11,"Compose"),b.ac(),b.ac(),b.ac(),b.Mc(12,y,17,2,"div",9),b.Mc(13,O,4,0,"div",10),b.Mc(14,k,2,0,"div",10),b.ac(),b.bc(15,"div",11),b.bc(16,"div",12),b.bc(17,"div",13),b.bc(18,"div",14),b.bc(19,"h5",15),b.Oc(20,"New Message"),b.ac(),b.bc(21,"button",16),b.bc(22,"i",17),b.Oc(23,"close"),b.ac(),b.ac(),b.ac(),b.bc(24,"div",18),b.bc(25,"div",19),b.bc(26,"label"),b.Oc(27,"Select who you want to send message to"),b.ac(),b.bc(28,"div",20),b.Mc(29,C,6,2,"a",21),b.Mc(30,w,4,0,"div",10),b.ac(),b.ac(),b.ac(),b.bc(31,"div",22),b.bc(32,"button",23),b.Oc(33,"Cancel"),b.ac(),b.ac(),b.ac(),b.ac(),b.ac(),b.bc(34,"div",24),b.bc(35,"div",12),b.bc(36,"div",13),b.bc(37,"div",14),b.bc(38,"h5",15),b.Oc(39,"New Message"),b.ac(),b.bc(40,"button",16),b.bc(41,"i",17),b.Oc(42,"close"),b.ac(),b.ac(),b.ac(),b.Mc(43,P,7,2,"div",25),b.bc(44,"div",22),b.bc(45,"button",23),b.Oc(46,"Cancel"),b.ac(),b.bc(47,"button",26),b.mc("click",(function(){return t.sendMessage()})),b.Oc(48," Send"),b.ac(),b.ac(),b.ac(),b.ac(),b.ac()),2&e&&(b.Ib(5),b.vc("routerLink",b.yc(8,T)),b.Ib(7),b.vc("ngIf",t.filteredThreads.length&&!t.loading),b.Ib(1),b.vc("ngIf",!t.filteredThreads.length&&!t.loading),b.Ib(1),b.vc("ngIf",t.loading),b.Ib(15),b.vc("ngForOf",t.users),b.Ib(1),b.vc("ngIf",!t.users.length),b.Ib(13),b.vc("ngIf",t.message),b.Ib(4),b.vc("disabled",!t.message.message))},directives:[o.d,i.n,i.m,h.c,r.b,r.i,r.l],styles:[".table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:8px 20px;text-transform:capitalize}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th.username[_ngcontent-%COMP%]{width:25%}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th.message[_ngcontent-%COMP%]{width:55%}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th.date[_ngcontent-%COMP%]{width:20%}.mail-title[_ngcontent-%COMP%]{padding:4px 0}"]}),U),_=s("7JkF"),F=function(e,t){return{"message-right":e,"message-left":t}};function x(e,t){if(1&e&&(b.bc(0,"ul",21),b.bc(1,"li",22),b.bc(2,"div",23),b.Xb(3,"img",24),b.ac(),b.bc(4,"div",25),b.bc(5,"p"),b.Oc(6),b.ac(),b.bc(7,"span"),b.Oc(8),b.ac(),b.ac(),b.ac(),b.ac()),2&e){var a=t.$implicit,c=b.pc();b.Ib(1),b.vc("ngClass",b.Ac(4,F,a.createdBy==c.currentUser.id,a.createdBy!=c.currentUser.id)),b.Ib(2),b.wc("src",c.imgUrl+a.user.profile.profileImg,b.Gc),b.Ib(3),b.Pc(a.message),b.Ib(2),b.Pc(c.Format(a.createdAt))}}var N,B,L=function(){return["/"]},D=function(){return["/messages"]},W=((N=function(){function t(a,c,s,n,i){e(this,t),this.activatedRoute=a,this.messageService=c,this.config=s,this.toastr=n,this.socket=i,this.chat=[]}return a(t,[{key:"ngOnInit",value:function(){var e=this;this.threadId=this.activatedRoute.snapshot.paramMap.get("threadId"),this.currentUser=JSON.parse(localStorage.getItem("user")),this.reciever=JSON.parse(localStorage.getItem("chatUser")),this.imgUrl=this.config.imgBaseUrl,this.getMessages(),this.currentDocument=this.socket.fromEvent("thread:"+this.threadId),this._docSub=this.currentDocument.subscribe((function(t){e.chat.push(t),setTimeout((function(){e.scrollToBottom()}),100)}))}},{key:"ngOnDestroy",value:function(){this._docSub.unsubscribe()}},{key:"getMessages",value:function(){var e=this;this.messageService.getChat(this.threadId).subscribe((function(t){e.chat=t.body,setTimeout((function(){e.scrollToBottom()}),500)}))}},{key:"scrollToBottom",value:function(){var e=document.getElementById("scrollDiv");e.scrollTop=e.scrollHeight}},{key:"Format",value:function(e){return d(e).format("MMMM Do, YYYY h:mm")}},{key:"SendMessage",value:function(){var e=this;this.message&&this.messageService.sendMessage({message:this.message,threadId:this.threadId,receiverId:this.reciever.userId}).subscribe((function(t){e.toastr.success("Message sent."),e.message=""}))}}]),t}()).\u0275fac=function(e){return new(e||N)(b.Wb(o.a),b.Wb(u),b.Wb(g.a),b.Wb(m.b),b.Wb(_.a))},N.\u0275cmp=b.Qb({type:N,selectors:[["app-messages"]],decls:28,vars:9,consts:[[1,"page-content"],[1,"page-info"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item"],[3,"routerLink"],["aria-current","page",1,"breadcrumb-item","active"],[1,"main-wrapper"],[1,"row"],[1,"col-lg-12"],[1,"card"],[1,"card-body","p-0"],[1,"msg-head"],["id","scrollDiv",1,"scrollbar",2,"height","400px"],["class","messages-wrap",4,"ngFor","ngForOf"],[1,"type-message",2,"border-radius","unset"],[1,"input"],["type","text","placeholder","Type your message here",1,"form-control",3,"ngModel","ngModelChange","keyup.enter"],[1,"send"],[1,"btn",3,"disabled","click"],["src","assets/images/ic-send-white.png","alt",""],[1,"messages-wrap"],[3,"ngClass"],[1,"user-thumb"],["alt","","onerror","this.src='assets/images/default-user.png'",3,"src"],[1,"chat-bubble"]],template:function(e,t){1&e&&(b.bc(0,"div",0),b.bc(1,"div",1),b.bc(2,"nav",2),b.bc(3,"ol",3),b.bc(4,"li",4),b.bc(5,"a",5),b.Oc(6,"Apps"),b.ac(),b.ac(),b.bc(7,"li",4),b.bc(8,"a",5),b.Oc(9,"Inbox"),b.ac(),b.ac(),b.bc(10,"li",6),b.Oc(11),b.ac(),b.ac(),b.ac(),b.ac(),b.bc(12,"div",7),b.bc(13,"div",8),b.bc(14,"div",9),b.bc(15,"div",10),b.bc(16,"div",11),b.bc(17,"div",12),b.bc(18,"h5"),b.Oc(19),b.ac(),b.ac(),b.bc(20,"div",13),b.Mc(21,x,9,7,"ul",14),b.ac(),b.bc(22,"div",15),b.bc(23,"div",16),b.bc(24,"input",17),b.mc("ngModelChange",(function(e){return t.message=e}))("keyup.enter",(function(){return t.SendMessage()})),b.ac(),b.ac(),b.bc(25,"div",18),b.bc(26,"button",19),b.mc("click",(function(){return t.SendMessage()})),b.Xb(27,"img",20),b.ac(),b.ac(),b.ac(),b.ac(),b.ac(),b.ac(),b.ac(),b.ac(),b.ac()),2&e&&(b.Ib(5),b.vc("routerLink",b.yc(7,L)),b.Ib(3),b.vc("routerLink",b.yc(8,D)),b.Ib(3),b.Qc(" ",t.reciever.user.firstName+" "+t.reciever.user.lastName," "),b.Ib(8),b.Pc(t.reciever.user.firstName+" "+t.reciever.user.lastName),b.Ib(2),b.vc("ngForOf",t.chat),b.Ib(3),b.vc("ngModel",t.message),b.Ib(2),b.vc("disabled",!t.message))},directives:[o.d,i.m,r.b,r.i,r.l,i.l],styles:[".msg-head[_ngcontent-%COMP%]{padding:12px 20px;border-bottom:1px solid #dae6f6}.msg-head[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin-bottom:0}.type-message[_ngcontent-%COMP%]{margin:0}.type-message[_ngcontent-%COMP%]   .send[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:14px}"]}),N),X={url:s("AytR").a.socketUrl,options:{}},E=[{path:"",component:S},{path:":threadId",component:W}],$=((B=function t(){e(this,t)}).\u0275mod=b.Ub({type:B}),B.\u0275inj=b.Tb({factory:function(e){return new(e||B)},imports:[[i.b,r.d,h.a,o.e.forChild(E),_.b.forRoot(X)]]}),B)}}])}();